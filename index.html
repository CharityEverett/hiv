<!DOCTYPE html>
<html>
  <head>
    <title>HIV Structure WebXR Experience</title>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script>
      AFRAME.registerComponent('virus-core', {
        init: function() {
          // Create the gray core sphere
          const core = document.createElement('a-sphere');
          core.setAttribute('radius', '2');
          core.setAttribute('color', '#808080');
          core.setAttribute('roughness', '1');
          core.setAttribute('metalness', '0.2');
          this.el.appendChild(core);

          // Generate protein spikes
          for (let i = 0; i < 60; i++) {
            const phi = Math.acos(-1 + (2 * i) / 60);
            const theta = Math.sqrt(60 * Math.PI) * phi;

            const x = 2 * Math.cos(theta) * Math.sin(phi);
            const y = 2 * Math.sin(theta) * Math.sin(phi);
            const z = 2 * Math.cos(phi);

            const spike = document.createElement('a-entity');
            spike.setAttribute('geometry', {
              primitive: 'cone',
              height: '0.8',
              radiusBottom: '0.2',
              radiusTop: '0.05'
            });
            spike.setAttribute('material', {
              color: '#FF4444',
              roughness: 0.7,
              metalness: 0.2
            });
            spike.setAttribute('position', `${x} ${y} ${z}`);
            spike.setAttribute('look-at', '0 0 0');
            this.el.appendChild(spike);
          }
        }
      });

      AFRAME.registerComponent('info-point', {
        schema: {
          label: {type: 'string'},
          description: {type: 'string'}
        },
        init: function() {
          const point = document.createElement('a-sphere');
          point.setAttribute('radius', '0.1');
          point.setAttribute('color', '#FFFFFF');
          this.el.appendChild(point);

          const text = document.createElement('a-text');
          text.setAttribute('value', this.data.label);
          text.setAttribute('align', 'center');
          text.setAttribute('position', '0 0.2 0');
          text.setAttribute('scale', '0.5 0.5 0.5');
          this.el.appendChild(text);
        }
      });
    </script>
  </head>
  <body>
    <a-scene>
      <!-- Environment -->
      <a-sky color="#000000"></a-sky>
      <a-entity light="type: ambient; intensity: 0.5"></a-entity>
      <a-entity light="type: directional; intensity: 0.8; position: -1 1 1"></a-entity>

      <!-- Main virus structure -->
      <a-entity
        id="virus-model"
        position="0 1.6 -4"
        rotation="0 0 0"
        virus-core
        animation="property: rotation; to: 0 360 0; loop: true; dur: 30000; easing: linear">
      </a-entity>

      <!-- Information points -->
      <a-entity
        position="-3 1.6 -4"
        info-point="label: Surface Proteins; description: Viral envelope proteins">
      </a-entity>

      <a-entity
        position="3 1.6 -4"
        info-point="label: Capsid Core; description: Houses viral RNA">
      </a-entity>

      <!-- Camera rig -->
      <a-entity position="0 1.6 0">
        <a-camera></a-camera>
        <a-cursor></a-cursor>
      </a-entity>
    </a-scene>
  </body>
</html>
